<div id="imagePrime">
<p id="imageInstructions">
<strong>Please play close attention to the image. You will be asked to answer questions about the image's content.</strong>
</p>
<div id="images"></div>
<div id="imageVerification"></div>
</div>

<style>
</style>

<script> 
(function() {
  var data = {}
    , rand = Math.floor(Math.random()*2)
    , imageData;

  init();

  function init() {
    experimentr.hideNext();
    experimentr.startTimer('imagePrime');
    d3.json('modules/images.json', function(err, d) {
      data.primingType = rand === 0 ? 'negative' : 'positive';
      imageData = data.primingType === 'negative' ? d['negative'] : d['positive']; // 0 negative; 1 positive; 2 positive
      console.log(imageData);
      loadimage();
    });
  }

  function loadimage() {
    d3.select('#images').append('img')
      .attr('width', 600)
      .attr('src', 'modules/img/iaps/'+imageData[0].id+'.jpg');
    d3.select('#images').append('button')
      .attr('type', 'button')
      .text('I have finished viewing the image and I am ready for the questions.')
      .on('click', loadQuestion);
  }

  function loadQuestion() {
    experimentr.showNext();
    d3.select('#images').remove();
    d3.select('#imageInstructions').remove();
    d3.select('#imageVerification').append('p')
      .text(imageData.question);
    var choices = d3.select('#imageVerification').selectAll('.choice')
      .data(imageData.choices)
      .enter().append('div')
      .classed('choice', true);
    choices.append('input')
      .attr('type', 'radio')
      .attr('name', 'imageVerification')
      .attr('value', function(d) { return d; });
    choices.append('label')
      .text(function(d) { return d; });
  d3.selectAll('input')
    .filter(function(d) { return this.name === 'imageVerification' ? this : null; })
    .on('change', function() { data.imageVerification = this.value; validate(); });
  }

  function validate() {
    if(data.imageVerification) {
      grade();
      experimentr.endTimer('imagePrime');
      experimentr.addData(data);
      experimentr.release();
    }
  }

  function grade() {
    if(data.imageVerification === imageData.answer)
      data.imageVerificationResult = true;
    else
      data.imageVerificationResult = false;
  }
}());
</script>
